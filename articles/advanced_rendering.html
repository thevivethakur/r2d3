<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Rendering with Callbacks • r2d3</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Advanced Rendering with Callbacks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2d3</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Using</li>
    <li>
      <a href="../articles/data_conversion.html">R to D3 Data Conversion</a>
    </li>
    <li>
      <a href="../articles/visualization_options.html">D3 Visualization Options</a>
    </li>
    <li>
      <a href="../articles/development_and_debugging.html">Development and Debugging</a>
    </li>
    <li>
      <a href="../articles/publishing.html">Publishing D3 Visualizations</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/shiny.html">Using r2d3 with Shiny</a>
    </li>
    <li>
      <a href="../articles/dependencies.html">CSS and JavaScript Dependencies </a>
    </li>
    <li>
      <a href="../articles/advanced_rendering.html">Advanced Rendering with Callbacks</a>
    </li>
    <li>
      <a href="../articles/package_development.html">Package Development</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/learning_d3.html">Learning D3</a>
</li>
<li>
  <a href="../articles/gallery.html">Gallery</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/r2d3/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced Rendering with Callbacks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/r2d3/blob/main/vignettes/advanced_rendering.Rmd" class="external-link"><code>vignettes/advanced_rendering.Rmd</code></a></small>
      <div class="hidden name"><code>advanced_rendering.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>By default, D3 visualizations created with <strong>r2d3</strong> are
monolithic scripts that do all of their work as a single computation
(the body of the script). While this makes scripts straightforward to
author by default, not all visualizations will confirm to this simple
model. Rather, some visualizations will want to distinguish between the
following activities:</p>
<ol style="list-style-type: decimal">
<li><p>Code that performs one-time initialization for the visualization
(e.g. creation of a D3 layout).</p></li>
<li><p>Code that runs whenever the data underlying the visualization is
changed.</p></li>
<li><p>Code that runs whenever the visualizations container element is
resized.</p></li>
</ol>
<p>This article describes how you can use the <strong>r2d3</strong>
advanced rendering API to organize your visualization code to run in
this more granular fashion.</p>
</div>
<div class="section level2">
<h2 id="onrender-callback">onRender Callback<a class="anchor" aria-label="anchor" href="#onrender-callback"></a>
</h2>
<p>To distinguish between code that runs at initialization-time only and
code that runs when data changes, organize your code so that the code
which responds to data changes is contained within the
<code>r2d3.onRender()</code> callback. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">// Initialization</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>svg</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"8"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a> <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    </span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">var</span> pack <span class="op">=</span> d3<span class="op">.</span><span class="fu">pack</span>()</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="op">.</span><span class="fu">size</span>([width<span class="op">,</span> height])</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="op">.</span><span class="fu">padding</span>(<span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="kw">var</span> format <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",d"</span>)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="kw">var</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(d3<span class="op">.</span><span class="at">schemeCategory20c</span>)<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">// Rendering</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>r2d3<span class="op">.</span><span class="fu">onRender</span>(<span class="kw">function</span>(data<span class="op">,</span> svg<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> options) {</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="kw">var</span> <span class="bu">root</span> <span class="op">=</span> d3<span class="op">.</span><span class="fu">hierarchy</span>({<span class="dt">children</span><span class="op">:</span> data})</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sum</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">value</span><span class="op">;</span> })</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(d) {</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>      <span class="cf">if</span> (id <span class="op">=</span> d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>        <span class="kw">var</span> id<span class="op">,</span> i <span class="op">=</span> id<span class="op">.</span><span class="fu">lastIndexOf</span>(<span class="st">"."</span>)<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>        d<span class="op">.</span><span class="at">id</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        d<span class="op">.</span><span class="at">package</span> <span class="op">=</span> id<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> i)<span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>        d<span class="op">.</span><span class="at">class</span> <span class="op">=</span> id<span class="op">.</span><span class="fu">slice</span>(i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>      }</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>  <span class="kw">var</span> node <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".node"</span>)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(<span class="fu">pack</span>(<span class="bu">root</span>)<span class="op">.</span><span class="fu">leaves</span>())</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"node"</span>)</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="st">"translate("</span> <span class="op">+</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="st">")"</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>  node<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">id</span><span class="op">;</span> })</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">r</span><span class="op">;</span> })</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">package</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>  node<span class="op">.</span><span class="fu">append</span>(<span class="st">"clipPath"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="st">"clip-"</span> <span class="op">+</span> d<span class="op">.</span><span class="at">id</span><span class="op">;</span> })</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"use"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"xlink:href"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="st">"#"</span> <span class="op">+</span> d<span class="op">.</span><span class="at">id</span><span class="op">;</span> })<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>  node<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span> <span class="kw">function</span>(d) { <span class="cf">return</span> <span class="st">"url(#clip-"</span> <span class="op">+</span> d<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">")"</span><span class="op">;</span> })</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"tspan"</span>)</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">class</span><span class="op">.</span><span class="fu">split</span>(<span class="ss">/</span><span class="sc">(?</span><span class="ss">=</span><span class="sc">[A-Z][^A-Z])</span><span class="ss">/g</span>)<span class="op">;</span> })</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="kw">function</span>(d<span class="op">,</span> i<span class="op">,</span> nodes) { <span class="cf">return</span> <span class="dv">13</span> <span class="op">+</span> (i <span class="op">-</span> nodes<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="dv">10</span><span class="op">;</span> })</span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>  node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span>(d) { <span class="cf">return</span> d<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> <span class="op">+</span> <span class="fu">format</span>(d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="onresize-callback">onResize Callback<a class="anchor" aria-label="anchor" href="#onresize-callback"></a>
</h2>
<p>By default, when the element which contains your visualization is
resized, <strong>r2d3</strong> will call back your script to re-render
the visualization from scratch using the new size. In some cases this
might be acceptable, but in other cases it makes sense to have code
which explicitly handles the resize in a more efficient fashion.</p>
<p>You can provide an explicit resize handler by implementing the
<code>r2d3.onResize()</code> callback. For example, in a force directed
D3 layout you might do this in the <code>onResize()</code> callback:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>r2d3<span class="op">.</span><span class="fu">onResize</span>(<span class="kw">function</span>(width<span class="op">,</span> height) {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  force<span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nick Strayer, Javier Luraschi, JJ Allaire.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
